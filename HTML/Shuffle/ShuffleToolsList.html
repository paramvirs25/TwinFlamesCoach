<style>
/* --- Shuffle result container --- */
.tfcShuffleToolListResult {
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 20px auto;
    max-width: 500px;
    width: 100%;
    text-align: center;
}

/* --- Shuffle history container --- */
.shuffleHistory {
    margin: 20px auto;
    max-width: 500px;
    padding: 10px;
}

/* --- Date separator (like WhatsApp style) --- */
.shuffle-date {
    text-align: center;
    font-weight: bold;
    margin: 15px 0 5px 0;
    color: #666;
    position: relative;
}
.shuffle-date::before,
.shuffle-date::after {
    content: "";
    position: absolute;
    top: 50%;
    width: 40%;
    height: 1px;
    background: #ccc;
}
.shuffle-date::before {
    left: 0;
}
.shuffle-date::after {
    right: 0;
}

/* --- Message bubble style --- */
.shuffle-message {
    background: #e6f3ff;
    border-radius: 10px;
    padding: 6px 10px;
    margin: 5px auto;
    max-width: 300px;
    text-align: center;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}
</style>

<script defer>
class TfcShuffle {
    static localStorageShuffleHistory = "tfcShuffleHistory";

    static shuffleToolsList() {
        const div = document.querySelector(".tfcToolsList");
        const containers = div.querySelectorAll(".vlp-link-container");
        if (containers.length === 0) return false;

        const randomIndex = Math.floor(Math.random() * containers.length);
        const randomContainer = containers[randomIndex];
        const clonedContainer = randomContainer.cloneNode(true);

        const resultElement = document.querySelector(".tfcShuffleToolListResult");
        resultElement.innerHTML = "";
        resultElement.appendChild(clonedContainer);

        const titleDiv = randomContainer.querySelector(".vlp-link-title");
        const titleText = titleDiv ? titleDiv.textContent.trim() : "Unknown";

        TfcShuffle.saveShuffleHistory(titleText);

        return false;
    }

    static saveShuffleHistory(titleText) {
        const today = new Date().toISOString().split("T")[0];
        let history = JSON.parse(localStorage.getItem(localStorageShuffleHistory) || "{}");

        if (!history[today]) history[today] = [];
        history[today].push(titleText);

        const allDates = Object.keys(history).sort((a, b) => new Date(b) - new Date(a));
        const trimmed = {};
        allDates.slice(0, 30).forEach(date => trimmed[date] = history[date]);

        localStorage.setItem(localStorageShuffleHistory, JSON.stringify(trimmed));
        TfcShuffle.renderShuffleHistory();
    }

    static renderShuffleHistory() {
        const container = document.querySelector(".shuffleHistory");
        if (!container) return;

        const history = JSON.parse(localStorage.getItem(localStorageShuffleHistory) || "{}");
        container.innerHTML = "";

        Object.keys(history)
            .sort((a, b) => new Date(b) - new Date(a))
            .forEach(date => {
                const dateHeader = document.createElement("div");
                dateHeader.textContent = new Date(date).toLocaleDateString();
                dateHeader.className = "shuffle-date";
                container.appendChild(dateHeader);

                history[date].forEach(title => {
                    const msg = document.createElement("div");
                    msg.textContent = title;
                    msg.className = "shuffle-message";
                    container.appendChild(msg);
                });
            });
    }
}

document.addEventListener("DOMContentLoaded", () => {
    TfcShuffle.renderShuffleHistory();
});
</script>

<div class="tfcShuffleToolListResult"></div>

